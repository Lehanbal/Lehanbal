---
title: 三次握手四次挥手
date: 2020-10-29 14:16:27
tags:
- 计算机网络
- TCP
categories: 
- 计算机网络
---

## 三次握手

注：注意: SYN/ACK包是仅SYN 和 ACK 标记为1的包.  

1. 当客户端（client）要与服务端（server）进行通信的时候，客户端会向服务端发SYN（Synchronized）标记的包，告诉服务端自己的初始化序列号（seq）请求建立连接。
2. 服务端收到后会发送一个对SYN包的确认包（SYN/ACK）回去，表示已经收到第一个SYN包，并且告诉客户端自己的初始序列号，并继续握手操作。
3. 客户端收到SYN/ACK包，之后发送一个ACK（Acknowledgement）确认包，去告诉服务端链接已经建立。

Server 发送 SYN 包是作为发起连接的 SYN 包，还是作为响应发起者的 SYN 包呢？怎么区分？

Server 的 ACK 确认包和接下来的 SYN 包可以合成一个 SYN/ACK 包一起发送的，没必要分别单独发送，这样省了一次交互同时也解决了问题。这样 TCP 建立一个连接，三次握手在进行最少次交互的情况下完成了 Peer 两端的资源分配和初始化序列号的交换。

## 四次挥手

1. 客户端发送一个FIN包来告诉服务端我没有数据需要发给你了。
2. 服务端收到后会回复一个ACK确认包说我知道了，但是等一下我还有东西要给你。
3. 过了一下，服务端自己也没有数据发送给客户端后，服务端也会发送一个FIN包给客服端告诉客户端我没东西了，关闭连接。
4. 客户端收到后会回复一个ACK确认包给服务端说我知道了。

四次挥手到此完毕，TCP连接就可以完全拆除了。

