---
title: 操作系统必杀题
date: 2020-10-30 12:39:51
tags:
- 操作系统
categories:
- 操作系统
---

## 进程间常见的状态，各个状态间得转换条件

![进程状态](https://gitee.com/lehanbal/blog-image/raw/master/img/进程状态转化.png)

- 就绪状态：进程得到了除了处理器之外的所有资源，一但该进程得到了处理器资源，便会立即执行。
- 执行状态：当一个进程获得必要的资源并在CPU上执行时，此时的进程状态就叫做执行状态。
- 阻塞状态：正在执行的程序，由于发生了某件事件而暂时无法执行下去，就会变成阻塞状态。这个状态下即使将CPU资源分配给它，依旧无法运行。
- 创建状态：进程正在被创建，尚未转到就绪状态。
- 结束状态：进程正在从系统中消失。

状态转化如下：

- 就绪->执行状态：一个进程被进程调度程序选中。
- 执行->就绪状态：时间片用完或者抢占式调度中有更高优先级的进程变成了就绪状态。
- 执行->阻塞状态：请求并等到某个事件的发生。
- 阻塞->就绪状态：进程因为等待的某个条件发生而被唤醒。

## 进程同步

进程同步的主要任务：是对多个相关进程在执行次序进行协调，以便并发执行的诸多进程能够有效地共享资源和相互合作，从而使程序的执行具有可再现性。

1. 空闲让进
2. 忙着等待（临界区信号量互斥）
3. 有限等待（等待有限时间，避免死锁）
4. 让权等待（当进程不能进入自己的临界区，应该释放掉处理机）

## 进程的通信方式

进程同步是指程序按照一定的顺序执行。

进程通信则是进程间传递信息。

通信方式有以下：

1. 管道：

   - 只支持半双工通信（单向交替传输）。
   - 只能在父进程或者兄弟进程间使用。

2. FIFO（命名管道）：

   去除了管道只能在父子进程间使用的限制，常用于客户-服务器应用程序中，FIFO用作聚焦点，在客户进程和服务器进程间传递数据。

3. 消息队列：

   相比FIFO，消息队列具备以下优点：

   - 消息队列可以独立于读写进程地存在，从而避免了FIFO中同步管道地打开和关闭时可能产生的困难。
   - 避免了FIFO地同步阻塞问题，不需要进程自己提供同步方法。
   - 读进程可以根据详细类型有选择地接受消息，而不像FIFO那样只能默认地接受。

4. 信号量：

   一个基础其，用于为多个进程提供对共享数据的访问。

5. 共享存储：

   允许多个进程共享一个给定的存储区。引擎为数据不需要在进程间复制，所以这种IPC效率很高。

   需要信号量来同步对共享存储区的访问。

6. 套接字：

   可以用于不同的机器间的进程通信。

## 上下文切换

上下文切换是一种将CPU资源从一个进程分配到另一个进程的机制。从用户角度看，计算机能够并运行多个进程，这恰恰是操作系统通过快速上下文切换造成的结果。在切换的过程中，操作系统需要保存当前进程的状态（保护CPU现场，内存间的指针，当前执行完的指令等等）在进入下一个进程的状态，然后执行此进程。

## 进程和线程的区别

调度：进程是操作系统资源分配的基本单位，线程是操作系统独立调度的基本单位。在同一个进程中，线程的切换不会引起进程的切换，而从一个进程的线程切换到另一个进程的线程会引起进程切换。

资源分配：进程是操作系统资源分配的基本单位，而线程不拥有系统资源，但是线程可以访问其归属的进程的系统资源。

并发性：进程之间可以并发执行，同一个进程内的线程也能够并发执行，这使得操作系统有很高的并发性，提高了操作系统的吞吐量。

系统开销：进程间切换需要保存当前的CPU线程，并且分配下一个进程所需要的资源，这一过程会造成较大的系统开销。线程之间的切换只需要保存少量寄存器的内容即可。

## 进程调度算法

FIFO（First Come First Served）先来先服务：

- 调度的顺序就是任务到来的顺序。
- 公平简单，非抢占式，不适合交互。

SJF（Shortest Job First）最短作业优先：

- 最短的作业优先调度。
- SJF可以保证最小的平均等待时间。

SRJF（Shortest Remaining Job First）:

- 最短剩余时间优先。
- SJF的可抢占版本。

优先权调度：

- 每个任务关联一个优先权，调度优先权最高的任务。
- 可能会一直出现优先权高的任务，导致优先权低的进程出现“饥饿”情况。

Round-Robin（RR）轮转调度算法：

- 设置一个时间片，按照时间片来轮转调度。
- 优点：定时有响应，等待时间较短。缺点：上下文切换次数较多。
- 时间片太长，响应时间长；时间片过短，吞吐量变小。时间片太长的话会退化成FCFS。

## 死锁的条件，如何处理死锁

死锁产生的四个必要条件：

1. 互斥：资源不能被共享，只能由一个进程使用。
2. 占有等等：已经得到资源的进程仍在继续申请新的资源。
3. 循环等待：系统中若干个进程组成环路，该环路每个进程都在等待相邻进程正占用的资源。
4. 不可抢占：已经分配的资源不能从相应的进程中强制地剥夺。

处理方法：

1. 鸵鸟策略：忽略该问题。
2. 检测死锁并恢复。
3. 预防死锁：破坏死锁产生的四个必要条件。
4. 死锁避免：银行家算法

## 临界资源

- 在操作系统中，进程是占有资源的最小单位，但是对于某些资源来说，同一时间只能被一个进程占用。这些一次只能被一个占用地资源就是所谓的临界资源。
- 对于临界资源的访问，必须是互斥进行的。当临界资源被占用时，另一个申请临界资源的进程会被阻塞，直到其申请的临界资源被释放。进程内访问临界资源的代码被称为临界区。

## 虚拟内存是什么，它的优缺点

虚拟内存的定义：具有请求调入功能和置换功能，能从逻辑上对内存容量加一扩充的一种存储器系统。其逻辑容量由内存之和和外存之和决定。

虚拟存储器有以下三个主要特征：

1. 多次性：程序不需要一次性全部转入内存，而是允许被分成多次调入内存运行。
2. 对换性，作业运行时无需常驻内存，而是允许在作业的运行过程中，进行换进和换出。
3. 虚拟性，从逻辑上扩大内存容量。

## 页面置换算法

操作系统间内存按照页面进行管理，在需要的时候才把进程相应的部分调入内存。当产生缺页中断的时候，需要选择一个页面写入。如果要换出的页面在内存中多次被修改过，就变成了“脏”页面，那就需要先写到磁盘。页面置换算法就是要选出最合适的页面使得置换效率最高。

1. 最优页面置换算法

   一种理论算法，选择下次最久会被使用到的页面进行置换，只存在理论之中。

2. 先进先出系列算法

   - FIFO（先进先出）：无情的置换机器，先进来的页面会被先换出。

   - 第二次机会：当页面要被置换的时候，给它标记以下，不把它置换，只是把它放到队尾，若页面被访问，就将标识清空，继续搜索下一个页面，一直找到最老的而且没被使用的页面，进行置换。
   - 时钟：第二次机会优化，将原来的链表整成头尾相连，提高效率。

3. 最近最久未使用算法（LRU）

   每次置换的时候，都将最近一次很久没使用的页面置换出去。详细的可以看我博客的LRU实现（JAVA）。

## 守护、僵尸、孤儿进程的概念

守护进程：运行在后台的一种特殊进程，独立于控制终端并周期性地执行某些任务（GC）。

僵尸进程：一个进程fork子进程，而父进程没有wait子进程，子进程的进程描述符仍保存在系统中，这叫做僵尸进程。

孤儿进程：一个父进程退出，它的子进程们仍在执行，这些子进程叫做孤儿进程。